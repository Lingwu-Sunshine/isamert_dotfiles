#!/bin/sh

# This script gets the requested password from a keepass file.
# It uses gnome-keyring to get password for kdbx file.
# $KEYRING_ID is the name of password field for your keepass database
# in gnome-keyring.
# Save your keepass database password to keyring like this:
# secret-tool store --label=KeePassDbPassword name keepass

# Usage:
# getpassword "/path/to/password/entry"

# To see your keepass db structre, use this:
# secret-tool lookup name keepass | keepassxc-cli ls /path/to/keepass/db/file

KEYRING_ID=keepass
KDBX_FILE="$HOME/Documents/sync/passwords.kdbx"
PASSWORD_PATH="$1"

secret-tool lookup name "$KEYRING_ID" | keepassxc-cli show "$KDBX_FILE" "$PASSWORD_PATH" | grep "Password: " | head -n 1 | cut -c 11-
