#!/bin/bash

# When using st, it expects window class properties while urxvt expects
# window name properties for enabling floating windows. So
# Rule for urxvt:
# bspc rule --add '*:float'   state=floating
# Rule for st:
# bspc rule --add 'float'     state=floating

# st, urxvt, urxvtc
RUNNER='st'
FLOAT=''
OPAQUE=''
NAME=''
OPTS=()

for arg; do
    case "$arg" in
        "--term="*) RUNNER=${arg#*=}; shift ;;
        "--name="*) NAME=${arg#*=}; shift ;;
        "--float") FLOAT='1'; shift ;;
        "--opaque") OPAQUE='1'; shift ;;
    esac
done

if [[ $RUNNER == 'urxvtc' ]]; then
    if ! pgrep urxvtd; then
        urxvtd & disown
        sleep 0.5
    fi
fi

if [[ -n "$FLOAT" ]]; then
    case "$RUNNER" in
        "st") OPTS+=(-c float) ;;
        "urxvt"*) OPTS+=(-name float) ;;
    esac
fi

if [[ -n "$NAME" ]]; then
    case "$RUNNER" in
        "st") OPTS+=(-c "$NAME") ;;
        "urxvt"*) OPTS+=(-name "$NAME") ;;
    esac
fi

if [[ -n "$OPAQUE" ]]; then
    case "$RUNNER" in
        "st") OPTS+=(-A 1) ;;
        "urxvt"*) OPTS+=(-bg "$(xrdb-get-value '*background')") ;;
    esac
fi

$RUNNER "${OPTS[@]}" "$@"
